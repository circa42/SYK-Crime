{% set firstLinkBlock = entry.storeLinks|first %}
{% if firstLinkBlock %}
  {% set storeCategory = firstLinkBlock.stores[0] %}
  {% set firstUrl = firstLinkBlock.storeLink %}
  {% set aff = '?linkCode=ll1&tag=sykcrime-20&language=en_US&ref_=as_li_ss_tl'|raw %}
  {% if storeCategory and "amazon" in storeCategory.slug %}
    {% set firstUrl = firstUrl ~ aff  %}
  {% endif %}
{% endif %}

<div class="book-entry flex xs:flex-wrap sm:flex-nowrap mb-8 bg-white drop-shadow border p-4">
  <!-- Book Image -->
  <div class="book-image sm:mr-6 flex mx-auto mb-8 justify-center">
    {% if entry.bookCover|length and firstUrl is defined %}
      <a href="{{ firstUrl }}" target="_blank">
        <img src="{{ entry.bookCover[0].getUrl('thumb') }}" alt="{{ entry.title }} cover" loading="lazy">
      </a>
    {% endif %}
  </div>

  <!-- Book Details --> 
  <div class="book-details xs:w-full">
    <!-- Title -->
    {% if entry.bookCover|length and firstUrl is defined %}
      
        <h2 class="text-xl font-bold">
          <a href="{{ firstUrl }}" target="_blank">
          {{ entry.title }}
        </a>
          {% if entry.explicit == 1 %}
            <span class="uppercase text-xs text-white bg-red-500 px-1 ml-4 relative -top-0.5" title="Explicit content" aria-label="Explicit content">E<span class="sr-only">Explicit content</span></span>
          {% endif %}
          {% if entry.shortRead == 1 %}
            <span class="uppercase text-xs text-white bg-blue-500 px-1 ml-4 relative -top-0.5" title="Short read" aria-label="Short read">S<span class="sr-only">Short read</span></span>
          {% endif %}
        </h2>
      
    {% else %}
      <h2 class="text-xl font-bold">
        {{ entry.title }}
        {% if entry.explicit == 1 %}
          <span class="uppercase text-xs text-white bg-red-500 px-1 ml-4 relative -top-0.5" title="Explicit content" aria-label="Explicit content">E<span class="sr-only">Explicit content</span></span>
        {% endif %}
      </h2>
    {% endif %}
    <h3 class="text-xs text-gray-400">{{ entry.authorName }}</h3>

    <!-- Hook -->
    {% if entry.hook %}
      <span class="my-4 text-sm">{{ entry.hook }}</span>
    {% endif %}

    <!-- Store Links -->
    <div class="mb-4">
      {% macro countryFlag(slug) %}
        {% switch slug %}
            {% case "amazon-us" %} ğŸ‡ºğŸ‡¸
            {% case "amazon-au" %} ğŸ‡¦ğŸ‡º
            {% case "amazon-br" %} ğŸ‡§ğŸ‡·
            {% case "amazon-ca" %} ğŸ‡¨ğŸ‡¦
            {% case "amazon-de" %} ğŸ‡©ğŸ‡ª
            {% case "amazon-es" %} ğŸ‡ªğŸ‡¸
            {% case "amazon-fr" %} ğŸ‡«ğŸ‡·
            {% case "amazon-in" %} ğŸ‡®ğŸ‡³
            {% case "amazon-it" %} ğŸ‡®ğŸ‡¹
            {% case "amazon-jp" %} ğŸ‡¯ğŸ‡µ
            {% case "amazon-mx" %} ğŸ‡²ğŸ‡½
            {% case "amazon-nl" %} ğŸ‡³ğŸ‡±
            {% case "amazon-uk" %} ğŸ‡¬ğŸ‡§
            {% default %} ğŸŒ
        {% endswitch %}
      {% endmacro %}

      {% if entry.storeLinks|length %}
        <div class="mb-2 mt-4">
          {% for block in entry.storeLinks %}
              {% set storeCategory = block.stores[0] %}
              {% if storeCategory %}
                  {% set url = block.storeLink %}
                  {% if "amazon" in storeCategory.slug %}
                      {% set url = url ~ aff  %}
                  {% endif %}
                  <a href="{{ url }}" class="xs:text-xs sm:text-sm text-gray-900 uppercase hover:bg-yellow-300 px-2 py-1 inline-block mb-1" target="_blank">
                      {{ _self.countryFlag(storeCategory.slug) }} {{ storeCategory.title }}
                  </a>
              {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Categories (Genre) -->
    <div class="genres">
      {% set genres = entry.genre %}
      {% if genres|length %}
        <div class="text-sm">
          <span class="font-bold">Categories:</span>
          {% for genre in genres %}
            <a href="{{ genre.url }}" class="hover:bg-yellow-300 p-1 mr-1 mb-2">{{ genre.title }}</a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Tags (Keywords) -->
    <div class="keywords">
      {% set keywords = entry.keywords %}
      {% if keywords|length %}
        <div class="text-sm">
          <span class="font-bold">Keywords:</span>
          {% for keyword in keywords %}
            <a href="{{ url('keywords/' ~ keyword.slug) }}" class="hover:bg-yellow-300 p-1 mr-1 mb-2">{{ keyword.title }}</a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Categories (Romance Level) -->
    <div class="romance-levels">
      {% set romanceLevels = entry.romanceLevel %}
      {% if romanceLevels|length %}
        <div class="text-sm">
          <span class="font-bold">Romance Level:</span>
          {% for romanceLevel in romanceLevels %}
            <a href="{{ romanceLevel.url }}" class="hover:bg-yellow-300 p-1 mr-1 mb-2">{{ romanceLevel.title }}</a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Explicit Content -->
    <div class="explicitCat">
      {% set explicitCats = entry.explicitCat %}
      {% if explicitCats|length %}
        <div class="text-sm">
          <span class="font-bold">Explicit Content: </span>
          {% for explicitCat in explicitCats %}
            <a href="{{ explicitCat.url }}" class="hover:bg-yellow-300 p-1 mr-1 mb-2">{{ explicitCat.title }}</a>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
