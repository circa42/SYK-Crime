{% extends "_layouts/base" %}

{% block content %}

{% set genre = craft.app.request.getQueryParam('genre') %}
{% set store = craft.app.request.getQueryParam('store') %}
{% set keywords = craft.app.request.getQueryParam('keywords') %}
{% set searchTerm = craft.app.request.getQueryParam('q') %}
{% set explicit = craft.app.request.getQueryParam('explicit') %}

{% set entriesQuery = craft.entries().section('books').search(searchTerm) %}

{# Apply genre filtering #}
{% if genre %}
    {% set genreIds = craft.categories.group('genre').slug(genre).ids() %}
    {% set entriesQuery = entriesQuery.relatedTo({ targetElement: genreIds }) %}
{% endif %}

{# Apply store filtering #}
{% if store %}
    {% set storeIds = craft.categories.group('store').slug(store).ids() %}
    {% set entriesQuery = entriesQuery.relatedTo({ targetElement: storeIds }) %}
{% endif %}

{# Apply keyword filtering #}
{% if keywords %}
    {% set keywordIds = craft.tags.group('keywords').slug(keywords).ids() %}
    {% set entriesQuery = entriesQuery.relatedTo({ targetElement: keywordIds }) %}
{% endif %}

{# Filter for explicit content
{% if explicit == '0' %}
    {% set entriesQuery = entriesQuery.andWhere(['explicit' => false]) %}
{% endif %}
 #}
{% set entries = entriesQuery.all() %}

<h1 class="text-bold font-black	text-center uppercase bg-yellow-300 px-4 py-2 inline-block mb-4">Search Results</h1>
    <div class="max-w-5xl mx-auto border-blue-500 border-2 my-12">

        {% if entries|length %}
            <div class="entry-list">
                {% for entry in entries %}
                    {% include "_includes/book" %}
                {% endfor %}
            </div>
        {% else %}
            <p>No results found based on your criteria.</p>
        {% endif %}
</div>
{% endblock %}